{% import _self as menus %}
{{ menus.menu_links(items, attributes, 0) }}

{% macro menu_links(items, attributes, menu_level) %}
  {% import _self as menus %}
  {% if items %}
    {% set ul_classes = menu_level == 0 ?  : ['submenu'] %}
    <ul{{ attributes.addClass(ul_classes) }}>
      {% for item in items %}
        {% set has_children = item.below is not empty %}
        <li{{ item.attributes.addClass(has_children ? 'has-submenu' : '') }}>
          <div class="menu-item-wrapper">
            {{ link(item.title, item.url) }}
            {% if has_children %}
              <button class="submenu-toggle" aria-expanded="false" aria-label="Toggle submenu"></button>
            {% endif %}
          </div>

          {% if has_children %}
            {{ menus.menu_links(item.below, attributes, menu_level + 1) }}
          {% endif %}
        </li>
      {% endfor %}
    </ul>
  {% endif %}
{% endmacro %}
